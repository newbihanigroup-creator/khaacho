# üöÄ Deploy Now - Quick Checklist

**Time Required**: 1-2 hours  
**Difficulty**: Intermediate

---

## ‚úÖ Pre-Deployment (30 minutes)

### 1. Google Cloud Setup

```bash
# Create project
1. Go to https://console.cloud.google.com
2. Create new project: "khaacho-production"
3. Enable APIs:
   - Cloud Vision API
   - Cloud Storage API
```

```bash
# Create GCS bucket
1. Go to Cloud Storage ‚Üí Buckets
2. Click "Create Bucket"
3. Name: khaacho-uploads
4. Location: us-central1 (or nearest to your users)
5. Storage class: Standard
6. Access control: Uniform
7. Create
```

```bash
# Create service account
1. Go to IAM & Admin ‚Üí Service Accounts
2. Click "Create Service Account"
3. Name: khaacho-service-account
4. Grant roles:
   - Cloud Vision API User
   - Storage Object Admin
5. Create key (JSON format)
6. Download and save securely
```

### 2. OpenAI Setup

```bash
1. Go to https://platform.openai.com
2. Sign up / Log in
3. Go to API Keys
4. Create new secret key
5. Copy and save: sk-...
6. Add payment method (if not already)
```

### 3. Render Setup

```bash
1. Go to https://render.com
2. Sign up / Log in
3. Connect GitHub account
4. Push your code to GitHub repository
```

---

## üóÑÔ∏è Database & Cache Setup (15 minutes)

### 1. Create PostgreSQL Database

```bash
Render Dashboard ‚Üí New ‚Üí PostgreSQL
‚îú‚îÄ Name: khaacho-db
‚îú‚îÄ Database: khaacho
‚îú‚îÄ User: khaacho
‚îú‚îÄ Region: Oregon
‚îú‚îÄ Plan: Starter ($7/month)
‚îî‚îÄ Create Database

Wait for provisioning (2-3 minutes)
Copy DATABASE_URL (will be auto-linked)
```

### 2. Create Redis Instance

```bash
Render Dashboard ‚Üí New ‚Üí Redis
‚îú‚îÄ Name: khaacho-redis
‚îú‚îÄ Region: Oregon
‚îú‚îÄ Plan: Starter ($10/month)
‚îî‚îÄ Create Redis

Wait for provisioning (2-3 minutes)
Copy REDIS_URL (will be auto-linked)
```

---

## üåê Web Service Setup (20 minutes)

### 1. Create Web Service

```bash
Render Dashboard ‚Üí New ‚Üí Web Service
‚îú‚îÄ Connect GitHub repository
‚îú‚îÄ Name: khaacho-api
‚îú‚îÄ Environment: Node
‚îú‚îÄ Region: Oregon
‚îú‚îÄ Branch: main (or your default branch)
‚îú‚îÄ Build Command: npm install && npx prisma generate && npx prisma migrate deploy
‚îú‚îÄ Start Command: npm run start:web
‚îî‚îÄ Plan: Starter ($7/month)
```

### 2. Configure Environment Variables

Click "Environment" tab and add:

```bash
# Core (Auto-configured)
NODE_ENV=production
PORT=10000
API_VERSION=v1
DATABASE_URL=<auto-linked>
REDIS_URL=<auto-linked>
JWT_SECRET=<auto-generated>
JWT_EXPIRES_IN=7d

# Google Cloud (PASTE YOUR VALUES)
GCS_BUCKET_NAME=khaacho-uploads
GCS_PROJECT_ID=<your-project-id>
GCS_CREDENTIALS=<paste-entire-json-from-service-account-key>
GOOGLE_CLOUD_PROJECT_ID=<your-project-id>
GOOGLE_CLOUD_CREDENTIALS=<paste-entire-json-from-service-account-key>

# OpenAI (PASTE YOUR KEY)
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini

# Features
ENABLE_BACKGROUND_JOBS=false
ASYNC_NOTIFICATIONS=true
ENABLE_METRICS=true
WHATSAPP_ASYNC=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
LOG_LEVEL=info

# Product Matching
PRODUCT_MATCH_THRESHOLD=0.7
```

### 3. Configure Health Check

```bash
Health Check Path: /api/health
```

### 4. Deploy

```bash
Click "Create Web Service"
Wait for build and deployment (5-10 minutes)
Monitor logs for errors
```

---

## ‚öôÔ∏è Worker Service Setup (15 minutes)

### 1. Create Worker Service

```bash
Render Dashboard ‚Üí New ‚Üí Background Worker
‚îú‚îÄ Connect GitHub repository
‚îú‚îÄ Name: khaacho-worker
‚îú‚îÄ Environment: Node
‚îú‚îÄ Region: Oregon
‚îú‚îÄ Branch: main
‚îú‚îÄ Build Command: npm install && npx prisma generate && npx prisma migrate deploy
‚îú‚îÄ Start Command: npm run start:worker
‚îî‚îÄ Plan: Starter ($7/month)
```

### 2. Configure Environment Variables

Copy ALL environment variables from Web Service, but change:

```bash
ENABLE_BACKGROUND_JOBS=true  # IMPORTANT: Set to true for worker
HEALTH_PORT=10001
```

### 3. Deploy

```bash
Click "Create Background Worker"
Wait for build and deployment (5-10 minutes)
Monitor logs for "Worker initialized" messages
```

---

## ‚úÖ Verification (10 minutes)

### 1. Check Web Service Health

```bash
# In browser or curl
https://khaacho-api.onrender.com/api/health

# Expected response:
{
  "status": "ok",
  "timestamp": "2026-02-13T...",
  "uptime": 123.45
}
```

### 2. Check Database Migrations

```bash
# In Render Web Service logs, look for:
‚úì Migrations applied successfully
‚úì 26 migrations applied
```

### 3. Check Worker Service

```bash
# In Render Worker Service logs, look for:
‚úì Worker initialized
‚úì Credit score worker initialized
‚úì Order routing worker initialized
‚úì Image processing queue ready
```

### 4. Test Image Upload (Optional)

```bash
# First, create a test user and get JWT token
# Then upload an image:

curl -X POST https://khaacho-api.onrender.com/api/v1/orders/upload-image \
  -H "Authorization: Bearer <your-jwt-token>" \
  -F "image=@test-order.jpg"

# Expected response:
{
  "success": true,
  "data": {
    "uploadedOrderId": "...",
    "imageUrl": "https://storage.googleapis.com/...",
    "status": "PROCESSING"
  },
  "message": "Image uploaded successfully. Processing in background."
}
```

---

## üéØ Post-Deployment

### 1. Monitor Logs

```bash
# Web Service
Render Dashboard ‚Üí khaacho-api ‚Üí Logs

# Worker Service
Render Dashboard ‚Üí khaacho-worker ‚Üí Logs

# Look for errors or warnings
```

### 2. Monitor Costs

```bash
# Google Cloud
https://console.cloud.google.com/billing

# OpenAI
https://platform.openai.com/usage

# Render
https://dashboard.render.com/billing
```

### 3. Set Up Alerts (Optional)

```bash
# Render
Dashboard ‚Üí khaacho-api ‚Üí Notifications
- Enable email alerts for failures
- Enable Slack/Discord webhooks

# Google Cloud
Console ‚Üí Monitoring ‚Üí Alerting
- Set budget alerts
- Set API usage alerts
```

---

## üêõ Troubleshooting

### Issue: "DATABASE_URL not found"

```bash
Solution:
1. Go to Web Service ‚Üí Environment
2. Check DATABASE_URL is linked to khaacho-db
3. If not, manually add from database connection string
```

### Issue: "REDIS_URL not found"

```bash
Solution:
1. Go to Web Service ‚Üí Environment
2. Check REDIS_URL is linked to khaacho-redis
3. If not, manually add from Redis connection string
```

### Issue: "GCS_CREDENTIALS invalid"

```bash
Solution:
1. Ensure JSON is properly formatted (no line breaks)
2. Escape quotes if needed
3. Or use GCS_KEY_FILE with file path
```

### Issue: "OPENAI_API_KEY invalid"

```bash
Solution:
1. Verify key at https://platform.openai.com/api-keys
2. Check key starts with "sk-"
3. Ensure billing is set up
```

### Issue: "Migrations failed"

```bash
Solution:
1. Check DATABASE_URL is correct
2. Check database is accessible
3. Manually run: npx prisma migrate deploy
4. Check logs for specific error
```

### Issue: "Worker not processing jobs"

```bash
Solution:
1. Check ENABLE_BACKGROUND_JOBS=true in worker
2. Check REDIS_URL is correct
3. Check worker logs for connection errors
4. Restart worker service
```

---

## üí∞ Cost Breakdown

### Monthly Costs

| Service | Plan | Cost |
|---------|------|------|
| Render Web Service | Starter | $7 |
| Render Worker Service | Starter | $7 |
| Render PostgreSQL | Starter | $7 |
| Render Redis | Starter | $10 |
| Google Cloud Storage | ~1GB | $0.50 |
| Google Vision API | ~1K images | $1.50 |
| OpenAI API | ~1K requests | $0.50 |
| **Total** | | **~$33.50/month** |

### Scaling Costs

| Usage | Monthly Cost |
|-------|--------------|
| 1,000 orders | $33.50 |
| 10,000 orders | $50-70 |
| 100,000 orders | $200-300 |

---

## üìû Need Help?

### Documentation
- `DEPLOYMENT_STATUS_SUMMARY.md` - Complete deployment status
- `AI_IMAGE_ORDER_QUICK_START.md` - Image processing guide
- `RENDER_NATIVE_DEPLOYMENT.md` - Render deployment details
- `SYSTEM_OVERVIEW.md` - System architecture

### Support
- **Render**: https://render.com/docs
- **Google Cloud**: https://cloud.google.com/support
- **OpenAI**: https://help.openai.com

---

## üéâ You're Done!

Your Khaacho B2B platform is now live and ready to process orders!

**Next Steps**:
1. Create admin user
2. Add products to catalog
3. Onboard retailers and wholesalers
4. Test image upload with real orders
5. Monitor performance and costs
6. Collect feedback and iterate

**Admin Panel**: https://khaacho-api.onrender.com/admin

---

**Deployment Date**: _____________  
**Deployed By**: _____________  
**Status**: ‚úÖ LIVE
